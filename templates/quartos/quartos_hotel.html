<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalhes do Quarto - {{ hotel.nome }}</title>

  <!-- Link para o NOVO CSS -->
  <link rel="stylesheet" href="/static/estilos/estilo_quarto_hotel.css">

  <!-- Fontes e Ícones do design de perfil -->
  <!-- Adiciona o Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>

<body>

  <!-- Estrutura de Sidebar e Overlay, consistente com a página de perfil -->
  <div id="overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <h2>Menu</h2>
    </div>
    <nav class="sidebar-nav">
      <a href="/"><i class="fa-solid fa-house"></i> Início</a>
      <a href="/quem_somos"><i class="fa-solid fa-users"></i> Quem Somos</a>
      <a href="/"><i class="fa-solid fa-bed"></i> Quartos</a>
      <a href="/pontos"><i class="fa-solid fa-map-location-dot"></i> Pontos Turísticos</a>
      <a href="/contato"><i class="fa-solid fa-envelope"></i> Contato</a>
      <a href="/templates/projeto.html"><i class="fa-solid fa-diagram-project"></i> Projeto</a>
      <!-- Link de volta para o perfil do hotel -->
      <a href="{{ url_for('hotel.perfil_hotel') }}"><i class="fa-solid fa-user-shield"></i> Perfil do Hotel</a>
    </nav>
  </aside>

  <div class="page-wrapper">
    <!-- Cabeçalho consistente com a página de perfil -->
    <header class="header">
      <div class="header-content">
        <div class="header-left">
          <button class="menu-btn" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
          </button>
          <h1>Detalhes do Quarto</h1>
        </div>
        <div class="header-right">
          <a href="{{endereco}}" class="btn btn-edit">
            <i class="fas fa-user"></i>
            <span>Ver Perfil</span>
          </a>
          <a href="/sair" class="btn btn-logout">
            <i class="fas fa-sign-out-alt"></i>
            <span>Sair</span>
          </a>
        </div>
      </div>
    </header>

    <!-- Conteúdo Principal Adaptado para a página de quartos -->
    <main class="main-content">
      <!-- Banner do Hotel -->
      <section class="hotel-banner">
        {% if hotel.background %}
        <img src="{{ url_for('static', filename=hotel.background) }}" alt="Imagem do hotel" class="banner-img">
        {% else %}
        <img
          src="https://www.kayak.com.br/news/wp-content/uploads/sites/12/2023/08/THEME_HOTEL_SIGN_FIVE_STARS_FACADE_BUILDING_GettyImages-1320779330-3.jpg"
          alt="Imagem padrão do hotel" class="banner-img">
        {% endif %}
        <div class="banner-overlay">
          <a href="{{url_for('hotel.pagina_hotel', id_hotel=hotel.id_hotel)}}" class="hotel-avatar-link">
            <img src="{{ url_for('static', filename=hotel.foto) }}" class="hotel-avatar-img" alt="Foto do Hotel">
          </a>
          <h2 class="hotel-name-banner">{{ hotel.nome }}</h2>
        </div>
      </section>

      <div class="grid-layout">
        <!-- Coluna de Informações e Reserva -->
        <div class="info-column">
          <section class="card">
            <h2 class="section-title">Quarto {{ quarto.andar }}° Andar, Nº {{ quarto.numero_quarto }}</h2>
            <p class="quarto-descricao">{{ quarto.descricao }}</p>
            <div class="quarto-preco">
              <i class="fa-solid fa-dollar-sign"></i>
              <span>Diária: <strong>{{ quarto.preco }} R$</strong></span>
            </div>
          </section>
          <section class="card">
            <h2 class="section-title">Verificar Disponibilidade e Reservar</h2>
            <form action="{{ rota }}" method="POST" class="form-reserva">
              <div class="date-picker-group">
                <div class="form-group">
                  <label for="checkin"><i class="fa-solid fa-calendar-day"></i> Check-in</label>
                  <input type="text" id="checkin" name="checkin" required placeholder="Selecione a data">
                </div>
                <div class="form-group">
                  <label for="checkout"><i class="fa-solid fa-calendar-day"></i> Check-out</label>
                  <input type="text" id="checkout" name="checkout" required placeholder="Selecione a data">
                </div>
              </div>
              {% if 'usuario' in session%}
              <button type="submit" class="btn btn-edit btn-reservar">{{ botao_reserva_texto }}</button>
              {%endif%}
            </form>
            {% if 'hotel' in session and session["hotel"]["id"] == quarto["id_hotel"] %}
            <a href="#" id="btn-editar-imagens"><i class="fas fa-edit"></i> Editar imagens do quarto</a><br>
            <a href="#" id="btn-deletar-quarto"><i class="fas fa-trash-alt"></i> Deletar quarto</a>
            {%endif%}
          </section>
        </div>
        <!-- Coluna da Galeria -->
        <div class="gallery-column">
          <section class="card">
            <h2 class="section-title">Galeria de Fotos</h2>
            <div class="galeria-quarto">
              <!-- Imagens de exemplo. As classes controlam o layout. -->
              <img src="{{ url_for('static', filename=quarto.imagem) }}" alt="1º foto do quarto" class="foto-principal">
              <img src="{{ url_for('static', filename=imagens_quarto.img1) }}" alt="2º foto do quarto">
              <img src="{{ url_for('static', filename=imagens_quarto.img2) }}" alt="3º foto do quarto">
              <img src="{{ url_for('static', filename=imagens_quarto.img3) }}" alt="4º foto do quarto">
              <img src="{{ url_for('static', filename=imagens_quarto.img4) }}" alt="4º foto do quarto">
            </div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <!-- Popup de Pagamento Redesenhado -->
  <div id="popup-pagamento" class="popup-pagamento">
    <div class="popup-conteudo card">
      <button id="fechar-popup" class="fechar-btn">&times;</button>
      <h2 class="section-title">Forma de Pagamento</h2>
      <div class="opcoes-pagamento">
        <div class="opcao-pagamento">
          <h3><i class="fa-regular fa-credit-card"></i> Cartão de Crédito</h3>
          <input type="text" placeholder="Número do Cartão">
          <input type="text" placeholder="Nome no Cartão">
          <input type="text" placeholder="Validade (MM/AA)">
          <input type="text" placeholder="CVV">
        </div>
        <div class="opcao-pagamento">
          <h3><i class="fa-brands fa-pix"></i> PIX</h3>
          <p>Chave PIX: <strong>{{hotel.chave_pix}}</strong></p>
        </div>
        <div class="opcao-pagamento">
          <h3><i class="fa-solid fa-concierge-bell"></i> Pagamento no Check-in</h3>
          <p>Você poderá pagar presencialmente no momento do check-in.</p>
        </div>
      </div>
      <button id="confirmar-pagamento" class="btn btn-edit">Confirmar Pagamento</button>
    </div>
  </div>

  <!-- Lightbox para visualização de imagens -->
  <div id="lightbox" class="lightbox">
    <span class="lightbox-fechar" onclick="fecharLightbox()">&times;</span>
    <img class="lightbox-conteudo" id="lightbox-img" alt="Imagem em tela cheia">
  </div>

  <!-- Popup de Edição de Imagens -->
  <div id="popup-editar-imagens" class="popup-pagamento">
    <div class="popup-conteudo card">
      <button id="fechar-popup-imagens" class="fechar-btn">&times;</button>
      <h2 class="section-title">Editar Imagens do Quarto</h2>
      <form action="/imagens_quarto/{{ quarto.id_quarto }}" method="POST" enctype="multipart/form-data">
        <div class="inputs-imagens">
          <label class="input-imagem" style="background-image: none;" id="l-img1">
            <span>+</span>
            <input type="file" name="imagem1" accept="image/*" onchange="previewThumb(event, 'img1')">
          </label>
          <label class="input-imagem" style="background-image: none;" id="l-img2">
            <span>+</span>
            <input type="file" name="imagem2" accept="image/*" onchange="previewThumb(event, 'img2')">
          </label>
          <label class="input-imagem" style="background-image: none;" id="l-img3">
            <span>+</span>
            <input type="file" name="imagem3" accept="image/*" onchange="previewThumb(event, 'img3')">
          </label>
          <label class="input-imagem" style="background-image: none;" id="l-img4">
            <span>+</span>
            <input type="file" name="imagem4" accept="image/*" onchange="previewThumb(event, 'img4')">
          </label>
          <label class="input-imagem" style="background-image: none;" id="l-img5">
            <span>+</span>
            <input type="file" name="imagem5" accept="image/*" onchange="previewThumb(event, 'img5')">
          </label>
          <label class="input-imagem" style="background-image: none;" id="l-img6">
            <span>+</span>
            <input type="file" name="imagem6" accept="image/*" onchange="previewThumb(event, 'img6')">
          </label>
        </div>
        <button type="submit" class="btn btn-edit">Salvar Imagens</button>
      </form>
    </div>
  </div>

  <!-- Popup de Deletar Quartos -->
  <div id="popup-deletar-quarto" class="popup-pagamento">
    <div class="popup-conteudo card">
      <button id="fechar-popup-deletar" class="fechar-btn">&times;</button>
      <h2 class="section-title">Tem certeza que quer deletar o quarto?</h2>
      <form action="/deletar_quarto/{{ quarto.id_quarto }}" method="POST">
        <button type="submit" class="btn btn-edit">Deletar</button>
      </form>
    </div>
  </div>


  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // Script do Menu Lateral (igual ao perfil_hotel)
    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("active");
      document.getElementById("overlay").classList.toggle("active");
    }

    // Script do Calendário (Flatpickr)
    const datasOcupadas = {{ datas_ocupadas | safe }};
    flatpickr("#checkin", {
      dateFormat: "Y-m-d",
      disable: datasOcupadas,
      minDate: "today"
    });
    flatpickr("#checkout", {
      dateFormat: "Y-m-d",
      disable: datasOcupadas,
      minDate: "today"
    });

    // Script do Popup de Pagamento
    document.addEventListener("DOMContentLoaded", function () {
      const formReserva = document.querySelector(".form-reserva");
      if (formReserva) {
        const popup = document.getElementById("popup-pagamento");
        const fechar = document.getElementById("fechar-popup");
        const confirmar = document.getElementById("confirmar-pagamento");

        formReserva.addEventListener("submit", function (e) {
          e.preventDefault();
          popup.classList.add("ativo");
        });

        fechar.addEventListener("click", function () {
          popup.classList.remove("ativo");
        });

        // Adiciona funcionalidade para fechar o popup ao clicar fora do conteúdo
        popup.addEventListener('click', (e) => {
          if (e.target === popup) {
            popup.classList.remove("ativo");
          }
        });

        confirmar.addEventListener("click", function () {
          popup.classList.remove("ativo");
          formReserva.submit();
        });
      }
    });

    // Script do Lightbox (visualizador de imagens)
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    const galeriaImagens = document.querySelectorAll('.galeria-quarto img');

    galeriaImagens.forEach(img => {
      img.addEventListener('click', () => {
        abrirLightbox(img.src);
      });
    });

    function abrirLightbox(src) {
      lightboxImg.src = src;
      lightbox.style.display = 'flex';
      setTimeout(() => lightbox.classList.add('ativo'), 10);
    }

    function fecharLightbox() {
      lightbox.classList.remove('ativo');
      setTimeout(() => lightbox.style.display = 'none', 400); // Espera a transição terminar
    }

    // Fecha o lightbox ao clicar na área escura (fora da imagem)
    lightbox.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        fecharLightbox();
      }
    });

    // Fecha o lightbox ao pressionar a tecla 'Esc'
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        fecharLightbox();
      }
    });

    // Script do Popup de Edição de Imagens
    document.addEventListener("DOMContentLoaded", function () {
      const btnEditar = document.getElementById("btn-editar-imagens");
      const popupImagens = document.getElementById("popup-editar-imagens");
      const fecharImagens = document.getElementById("fechar-popup-imagens");

      if (btnEditar) {
        btnEditar.addEventListener("click", function (e) {
          e.preventDefault();
          popupImagens.classList.add("ativo");
        });
      }

      if (fecharImagens) {
        fecharImagens.addEventListener("click", function () {
          popupImagens.classList.remove("ativo");
        });
      }

      // Fecha ao clicar fora
      popupImagens.addEventListener('click', (e) => {
        if (e.target === popupImagens) {
          popupImagens.classList.remove("ativo");
        }
      });
    });

    // Script do Popup de Deletar Quartos
    document.addEventListener("DOMContentLoaded", function () {
      const btnDeletar = document.getElementById("btn-deletar-quarto");
      const popupDeletar = document.getElementById("popup-deletar-quarto");
      const fecharDeletar = document.getElementById("fechar-popup-deletar");

      if (btnDeletar) {
        btnDeletar.addEventListener("click", function (e) {
          e.preventDefault();
          popupDeletar.classList.add("ativo");
        });
      }

      if (fecharDeletar) {
        fecharDeletar.addEventListener("click", function () {
          popupDeletar.classList.remove("ativo");
        });
      }

      // Fecha ao clicar fora
      popupDeletar.addEventListener('click', (e) => {
        if (e.target === popupDeletar) {
          popupDeletar.classList.remove("ativo");
        }
      });
    });

    //previzualizar imagems
    function previewThumb(event, id) {
      const file = event.target.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        const label = document.getElementById("l-" + id);
        label.style.backgroundImage = `url(${url})`;
        label.querySelector('span').textContent = ''; // remove o "+" quando a imagem aparece
      }
    }
  </script>

</body>

</html>